(this["webpackJsonpreact-hook-speech-to-text"]=this["webpackJsonpreact-hook-speech-to-text"]||[]).push([[0],{23:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var r,o,a=n(1),c=n(12),i=n.n(c),s=n(9),u=n(2),l=n(6),d=n(4),f=n(5),p=n(13),h=n.n(p),g=n(14),b=n(15),v=n(16),m=n.n(v),w=function(){function e(t,n){var r=this;Object(g.a)(this,e),this.config=Object(s.a)({bufferLen:4096,numChannels:1,mimeType:"audio/wav"},n),this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(e){if(r.recording){for(var t=[],n=0;n<r.config.numChannels;n++)t.push(e.inputBuffer.getChannelData(n));r.worker.postMessage({command:"record",buffer:t})}},t.connect(this.node),this.node.connect(this.context.destination);this.worker=new m.a((function(){var e,t,n,r=0,o=[];function a(){for(var e=0;e<t;e++)o[e]=[]}function c(e,t){for(var n=new Float32Array(t),r=0,o=0;o<e.length;o++)n.set(e[o],r),r+=e[o].length;return n}function i(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}this.onmessage=function(s){switch(s.data.command){case"init":u=s.data.config,e=u.sampleRate,t=u.numChannels,a(),n=e>48e3?48e3:e;break;case"record":!function(e){for(var n=0;n<t;n++)o[n].push(e[n]);r+=e[0].length}(s.data.buffer);break;case"exportWAV":!function(a){for(var s,u=[],l=0;l<t;l++)u.push(c(o[l],r));s=2===t?function(e,t){var n=e.length+t.length,r=new Float32Array(n),o=0,a=0;for(;o<n;)r[o++]=e[a],r[o++]=t[a],a++;return r}(u[0],u[1]):u[0];var d=function(e){var r=new ArrayBuffer(44+2*e.length),o=new DataView(r);return i(o,0,"RIFF"),o.setUint32(4,36+2*e.length,!0),i(o,8,"WAVE"),i(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,t,!0),o.setUint32(24,n,!0),o.setUint32(28,4*n,!0),o.setUint16(32,2*t,!0),o.setUint16(34,16,!0),i(o,36,"data"),o.setUint32(40,2*e.length,!0),function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var o=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}(o,44,e),o}(function(t,n){if(n==e)return t;if(n>e)throw"downsampling rate show be smaller than original sample rate";var r=e/n,o=Math.round(t.length/r),a=new Float32Array(o),c=0,i=0;for(;c<a.length;){for(var s=Math.round((c+1)*r),u=0,l=0,d=i;d<s&&d<t.length;d++)u+=t[d],l++;a[c]=u/l,c++,i=s}return a}(s,n)),f=new Blob([d],{type:a});this.postMessage({command:"exportWAV",data:f})}(s.data.type);break;case"getBuffer":!function(){for(var e=[],n=0;n<t;n++)e.push(c(o[n],r));this.postMessage({command:"getBuffer",data:e})}();break;case"clear":r=0,o=[],a()}var u}}),{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(e){var t=r.callbacks[e.data.command].pop();"function"==typeof t&&t(e.data.data)}}return Object(b.a)(e,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker.postMessage({command:"exportWAV",type:t})}}],[{key:"forceDownload",value:function(e,t){var n=(window.URL||window.webkitURL).createObjectURL(e),r=window.document.createElement("a");r.href=n,r.download=t||"output.wav";var o=document.createEvent("Event");o.initEvent("click",!0,!0),r.dispatchEvent(o)}}]),e}(),x=w,j=x;function O(e){return k.apply(this,arguments)}function k(){return(k=Object(l.a)(Object(u.a)().mark((function e(t){var n,a,c,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.audioContext,a=t.errHandler,c=t.onStreamLoad,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:return i=e.sent,c&&c(),r=i,o=n.createMediaStreamSource(i),(j=new x(o)).record(),e.abrupt("return",i);case 13:e.prev=13,e.t0=e.catch(1),console.log(e.t0),a&&a();case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function R(e){var t=e.exportWAV,n=e.wavCallback;j.stop(),r.getAudioTracks()[0].stop(),t&&n&&j.exportWAV((function(e){return n(e)})),j.clear()}var S,y=-1!==navigator.userAgent.indexOf("Edg/"),A=window.AudioContext||window.webkitAudioContext,C=window.SpeechRecognition||window.webkitSpeechRecognition;navigator.brave&&navigator.brave.isBrave().then((function(e){e&&(S=null)})),!y&&C&&(S=new C);var T=n.p+"static/media/mic.b386a135.svg",U=(n(23),n(0));function E(){var e=function(e){var t=e.continuous,n=e.crossBrowser,r=e.googleApiKey,o=e.googleCloudRecognitionConfig,c=e.onStartSpeaking,i=e.onStoppedSpeaking,p=e.speechRecognitionProperties,g=void 0===p?{interimResults:!0,lang:"en-US"}:p,b=e.timeout,v=void 0===b?1e4:b,m=e.useOnlyGoogleCloud,w=void 0!==m&&m,x=e.useLegacyResults,j=void 0===x||x,k=Object(a.useState)(!1),y=Object(f.a)(k,2),C=y[0],T=y[1],U=Object(a.useRef)(),E=Object(a.useState)([]),M=Object(f.a)(E,2),W=M[0],B=M[1],L=Object(a.useState)([]),V=Object(f.a)(L,2),P=V[0],_=V[1],D=Object(a.useState)(),I=Object(f.a)(D,2),F=I[0],H=I[1],K=Object(a.useState)(""),N=Object(f.a)(K,2),J=N[0],z=N[1],G=Object(a.useRef)(),Y=Object(a.useRef)();Object(a.useEffect)((function(){var e,t;n||S||z("Speech Recognition API is only available on Chrome"),null!==(e=navigator)&&void 0!==e&&null!==(t=e.mediaDevices)&&void 0!==t&&t.getUserMedia||z("getUserMedia is not supported on this device/browser :("),!n&&!w||r||console.error("No google cloud API key was passed, google API will not be able to process speech"),U.current||(U.current=new A),j&&console.warn("react-hook-speech-to-text is using legacy results, pass useLegacyResults: false to the hook to use the new array of objects results. Legacy array of strings results will be removed in a future version.")}),[]);var q=function(){if(S){t&&(S.continuous=!0);var e=g||{},n=e.grammars,r=e.interimResults,o=e.lang,a=e.maxAlternatives;n&&(S.grammars=n),o&&(S.lang=o),S.interimResults=r||!1,S.maxAlternatives=a||1,S.start(),S.onresult=function(e){var t=e.results[e.results.length-1],n=t[0].transcript,o=Math.floor(Date.now()/1e3);if(r)if(t.isFinal)H(void 0),_((function(e){return[].concat(Object(d.a)(e),[{transcript:n,timestamp:o}])})),B((function(e){return[].concat(Object(d.a)(e),[n])}));else{for(var a="",c=e.resultIndex;c<e.results.length;c++)a+=e.results[c][0].transcript;H(a)}else _((function(e){return[].concat(Object(d.a)(e),[{transcript:n,timestamp:o}])})),B((function(e){return[].concat(Object(d.a)(e),[n])}))},S.onaudiostart=function(){return T(!0)},S.onend=function(){T(!1)}}},Q=function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var r,o,a,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w||!S){e.next=3;break}return q(),e.abrupt("return");case 3:if(n||w){e.next=5;break}return e.abrupt("return");case 5:return"suspended"===(null===(r=U.current)||void 0===r?void 0:r.state)&&(null===(o=U.current)||void 0===o||o.resume()),e.next=8,O({errHandler:function(){return z("Microphone permission was denied")},audioContext:U.current});case 8:a=e.sent,T(!0),v&&(clearTimeout(G.current),X()),Y.current&&$(),Y.current=a.clone(),(s=h()(Y.current,{audioContext:U.current})).on("speaking",(function(){c&&c(),clearTimeout(G.current)})),s.on("stopped_speaking",(function(){i&&i(),R({exportWAV:!0,wavCallback:function(e){return Z({blob:e,continuous:t||!1})}})}));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){G.current=window.setTimeout((function(){T(!1),$(),R({exportWAV:!1})}),v)},Z=function(e){var t=e.blob,n=e.continuous,a=new FileReader;a.readAsDataURL(t),a.onloadend=Object(l.a)(Object(u.a)().mark((function e(){var c,i,l,f,p,h,g,b,v,m;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=a.result,(f=null===(c=U.current)||void 0===c?void 0:c.sampleRate)&&f>48e3&&(f=48e3),p={content:""},h=Object(s.a)({encoding:"LINEAR16",languageCode:"en-US",sampleRateHertz:f},o),g={config:h,audio:p},p.content=l.substr(l.indexOf(",")+1),e.next=9,fetch("https://speech.googleapis.com/v1/speech:recognize?key=".concat(r),{method:"POST",body:JSON.stringify(g)});case 9:return b=e.sent,e.next=12,b.json();case 12:v=e.sent,(null===(i=v.results)||void 0===i?void 0:i.length)>0&&(m=v.results[0].alternatives[0].transcript,B((function(e){return[].concat(Object(d.a)(e),[m])})),_((function(e){return[].concat(Object(d.a)(e),[{speechBlob:t,transcript:m,timestamp:Math.floor(Date.now()/1e3)}])}))),n?Q():($(),T(!1));case 15:case"end":return e.stop()}}),e)})))},$=function(){var e;null===(e=Y.current)||void 0===e||e.getAudioTracks()[0].stop()};return{error:J,interimResult:F,isRecording:C,results:j?W:P,setResults:_,startSpeechToText:Q,stopSpeechToText:function(){S&&!w?S.stop():(T(!1),$(),R({exportWAV:!0,wavCallback:function(e){return Z({blob:e,continuous:!1})}}))}}}({continuous:!0,crossBrowser:!1,googleApiKey:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_KEY,speechRecognitionProperties:{interimResults:!0,lang:"en-US"},useLegacyResults:!1}),t=e.error,n=e.interimResult,r=e.isRecording,o=e.results,c=e.startSpeechToText,i=e.stopSpeechToText;return t?Object(U.jsx)("div",{style:{maxWidth:"600px",margin:"100px auto",textAlign:"center"},children:Object(U.jsxs)("p",{children:[t,Object(U.jsx)("span",{style:{fontSize:"3rem"},children:"\ud83e\udd37\u200d"})]})}):Object(U.jsxs)("div",{style:{maxWidth:"600px",margin:"100px auto",textAlign:"center"},children:[Object(U.jsxs)("h1",{children:["Recording: ",r.toString()]}),Object(U.jsxs)("button",{onClick:r?i:c,children:[Object(U.jsx)("span",{children:r?"Stop Recording":"Start Recording"}),Object(U.jsx)("img",{"data-recording":r,src:T,alt:""})]}),Object(U.jsxs)("ul",{children:[o.map((function(e){return Object(U.jsx)("li",{children:e.transcript},e.timestamp)})),n&&Object(U.jsx)("li",{children:n})]})]})}i.a.render(Object(U.jsx)(E,{}),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.20e511d6.chunk.js.map